You are building an e-commerce web application for 360 Logistic using Next.js 14 (App Router), TypeScript, styled-components, and Supabase.

=====================
CORE CONCEPT
=====================

- A PRODUCT is a container.
- A PRODUCT always has at least ONE purchasable option.
- That option can be:

  - the BASE PRODUCT itself, or
  - a VARIATION of the product.

- Variations are OPTIONAL.
- If no variations exist → the base product itself is the purchasable option.
- If variations exist → base product + variations are shown as selectable options.

The system always works with OPTIONS, not products.

=====================
PURCHASING RULES
=====================

- Cart and orders operate on OPTION LEVEL.
- An option can be:

  - Base product (variation_id = null)
  - Product variation (variation_id = UUID)

- Every option MUST have:
  - price
  - image

Source of truth:

- Base option:
  - price → products.price
  - image → products.image_url
- Variation option:
  - price → product_variations.price
  - image → product_variations.image_url

Displayed price & image must always come from the selected option.

=====================
PRODUCT PAGE LOGIC
=====================

- Fetch product + active variations.
- Build options array:
  - First option = base product
  - Other options = variations

Rules:

- If only base option exists → auto-selected
- If variations exist → base option is default, others selectable
- User must select exactly one option before adding to cart

=====================
CART RULES
=====================

Cart items are based on OPTIONS.

Each cart item contains:

- product_id
- variation_id (nullable)
- option_name
- price (snapshot)
- image
- quantity

Grouping rule:

- Items are grouped by:
  - variation_id if present
  - otherwise product_id

=====================
CHECKOUT RULES
=====================

- Checkout allowed only for authenticated users.
- Create:
  - order
  - order_items (one per cart item)
- order_items:

  - product_id always present
  - variation_id nullable
  - price is snapshot at time of order

- Send order confirmation email after successful creation.

=====================
ADMIN PANEL (IN SCOPE)
=====================

Admin users can:

- Manage categories (CRUD)
- Manage products (CRUD)
- Manage product variations (CRUD)
- Manage orders (read + optional status update)

Rules:

- Admin routes must be protected.
- Non-admin users must not access admin routes.

=====================
DATABASE RULES
=====================

Tables used:

- categories
- products
- product_variations
- orders
- order_items
- user_profiles (optional)

Key rules:

- products are not purchasable directly unless used as base option
- product_variations override price & image
- variation_id is nullable in order_items

=====================
UI RULES
=====================

- Product listing shows each product once.
- Product page shows:
  - selected option image
  - selected option price
- No duplicated products for variations.
- UI must be minimal and clean (no Tailwind).

=====================
ENGINEERING RULES
=====================

- Use TypeScript everywhere.
- Keep components small and predictable.
- Use environment variables for secrets.
- Implement SR / EN i18n with SEO support.
- Implement sitemap, robots.txt, and schema.org Product.

=====================
OUT OF SCOPE
=====================

- Online payments
- Subscriptions
- Advanced analytics

=====================
FINAL NOTE
=====================

This file is the single source of truth.
If something is unclear, follow this file over assumptions.
